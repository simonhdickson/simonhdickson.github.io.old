
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Simon Dickson's Blog</title>
        <meta name="author" content="Simon Dickson">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
        <!--[if lt IE 9]>
         <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link href="http://localhost:8080/FsBlog/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <link href="http://localhost:8080/FsBlog/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
        <link href="http://localhost:8080/FsBlog/css/style.css" rel="stylesheet">
        <link href="Model.Root/resources/syntax/syntax.css" rel="stylesheet">
        <!-- FSharp.Formatting Styles --> 
        <link rel="stylesheet" type="text/css" media="screen" href="http://localhost:8080/FsBlog/fsharp.formatting/tooltips.css" /> 
        <script type="text/javascript" src="http://localhost:8080/FsBlog/fsharp.formatting/tooltips.js"></script>
        <link rel="alternate" type="application/rss+xml" title="Simon Dickson's Blog" href="http://localhost:8080/FsBlog/rss.xml">
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-46304436-1', 'auto');
          ga('send', 'pageview');

        </script>
    </head>
    <body>
        <nav class="navbar navbar-default visible-xs" role="navigation">
		    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		        <ul class="nav navbar-nav">
			        <li class="active"><a href="http://localhost:8080/FsBlog/">Home</a></li>
			        <li class="active"><a href="http://localhost:8080/FsBlog/about">About</a></li>
			        <li class="active"><a href="http://localhost:8080/FsBlog/iwdev">IWDev</a></li>
		        </ul>
		    </div>
	    </nav>
        <div class="col-sm-3 sidebar hidden-xs">
			<header class="sidebar-header" role="banner">
                <a href="http://localhost:8080/FsBlog/">
		            <img src="http://www.gravatar.com/avatar/db889c0148e478a362dd7a3c5fb818a5?s=150" class="img-circle" />
	            </a>
                <h3 class="title">
                    Simon Dickson's Blog
                </h3>
<div id="contact-list" class="text-center">
    <ul class="list-unstyled list-inline">
        
        <li>
            <a class="btn btn-default btn-sm" href="https://github.com/simonhdickson">
                <i class="fa fa-github-alt fa-lg"></i>
            </a>
        </li>
        
        
        <li>
            <a class="btn btn-default btn-sm" href="https://twitter.com/SimonHDickson">
                <i class="fa fa-twitter fa-lg"></i>
            </a>
        </li>
    </ul>
    <ul id="contact-list-secondary" class="list-unstyled list-inline">
        
        <li>
            <a class="btn btn-default btn-sm" href="https://www.linkedin.com/profile/view?id=51586131">
                <i class="fa fa-linkedin fa-lg"></i>
            </a>
        </li>
        
        <li>
            <a class="btn btn-default btn-sm" href="http://localhost:8080/FsBlog/rss.xml">
                <i class="fa fa-rss fa-lg"></i>
            </a>
        </li>
    </ul>
</div>
</header>
</div>
        <div class="col-sm-9 col-sm-offset-3">
			

<article>
    <div class="page-header">
        <h1>Nancy + F# = Fancy</h1>
    </div>
    <div class="col-sm-10">
        <span class="post-date">
            
        </span>
        <div class="article_body">
            
<p>Last week I made the <a href="blog/2013/12/03/owin-the-myth">owin monad</a>, and when I showed it to <a href="https://twitter.com/nbevans">@nbevans</a> he suggested making it work with nancy.</p>

<p>So I did.</p>

<p>Let me introduce Fancy:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">pipeline</span> <span class="o">=</span>
    <span class="i">fancy</span> {
        <span class="i">get</span> <span class="s">&quot;</span><span class="s">/</span><span class="s">&quot;</span> (<span class="k">fun</span> () <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">Hello</span><span class="s"> </span><span class="s">World</span><span class="s">!</span><span class="s">&quot;</span>)
        <span class="i">get</span> <span class="s">&quot;</span><span class="s">/</span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> (<span class="k">fun</span> <span class="i">name</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs2', 3)" onmouseover="showTip(event, 'fs2', 3)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">Hello</span><span class="s"> </span><span class="s">%</span><span class="s">s</span><span class="s">!</span><span class="s">&quot;</span> <span class="i">name</span>) 
        <span class="i">get</span> <span class="s">&quot;</span><span class="s">/</span><span class="s">square</span><span class="s">/</span><span class="s">%</span><span class="s">i</span><span class="s">&quot;</span> (<span class="k">fun</span> <span class="i">number</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs2', 4)" onmouseover="showTip(event, 'fs2', 4)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">i</span><span class="s">&quot;</span> <span class="o">&lt;|</span> <span class="i">number</span> <span class="o">*</span> <span class="i">number</span>) 
    }</pre>
</td>
</tr>
</table>

<p>I won't dig too heavily into the code at this moment, it is quite ugly and hacky in places. It is also obviously not production ready. However, the nice thing about this is that it is fully typed, i.e:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 5)" onmouseover="showTip(event, 'fs1', 5)" class="i">pipeline</span> <span class="o">=</span>
    <span class="i">fancy</span> {
        <span class="i">get</span> <span class="s">&quot;</span><span class="s">/</span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> (<span class="k">fun</span> <span class="i">name</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs2', 6)" onmouseover="showTip(event, 'fs2', 6)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> <span class="i">name</span>)       <span class="c">// Works</span>
        <span class="i">get</span> <span class="s">&quot;</span><span class="s">/</span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> (<span class="k">fun</span> (<span class="i">name</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 7)" onmouseover="showTip(event, 'fs3', 7)" class="i">int</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs2', 8)" onmouseover="showTip(event, 'fs2', 8)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> <span class="i">name</span>) <span class="c">// Compiler error!</span>
        <span class="i">get</span> <span class="s">&quot;</span><span class="s">/</span><span class="s">%</span><span class="s">i</span><span class="s">&quot;</span> (<span class="k">fun</span> <span class="i">name</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs2', 9)" onmouseover="showTip(event, 'fs2', 9)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> <span class="i">name</span>)       <span class="c">// Compiler error!</span>
        <span class="i">get</span> <span class="s">&quot;</span><span class="s">/</span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> (<span class="k">fun</span> <span class="i">name</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs2', 10)" onmouseover="showTip(event, 'fs2', 10)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">i</span><span class="s">&quot;</span> <span class="i">name</span>)       <span class="c">// Compiler error!</span>
    }</pre>
</td>
</tr>
</table>

<p>Now if you know your nancy, you'll know that nancy doesn't expect the format "/%s" or "/%i"; it expects the format "/{name}" or "/{number:int}". And you probably also know that all normally StringFormat functions in F# take type parameters, rather than a function of those types.</p>

<p>Well what happens is we're only using StringFormat for static type checking, we're not actually using StringFormat here quite as it was intended.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">member</span> <span class="i">this</span><span class="o">.</span><span class="i">Get</span>(<span class="i">m</span>, <span class="i">url</span><span class="o">:</span><span class="i">StringFormat</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">a</span><span class="k">-&gt;</span><span class="o">&#39;</span><span class="i">b</span>,<span class="o">&#39;</span><span class="i">c</span><span class="o">&gt;</span>, <span class="i">processor</span><span class="o">:</span><span class="o">&#39;</span><span class="i">a</span><span class="k">-&gt;</span><span class="o">&#39;</span><span class="i">b</span>) <span class="o">=</span>
    <span class="c">// ommitted</span></pre>
</td>
</tr>
</table>

<p>These type constraints do that. There is actually a slight error, with the above code, but I'm reasonably certain it can be converted into a feature. You see you are required to have the correct parameters in the correct order, but extra paramters are allowed.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 11)" onmouseover="showTip(event, 'fs1', 11)" class="i">pipeline</span> <span class="o">=</span>
    <span class="i">fancy</span> {
        <span class="i">get</span> <span class="s">&quot;</span><span class="s">/</span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> (<span class="k">fun</span> <span class="i">name</span> (<span class="i">other</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 12)" onmouseover="showTip(event, 'fs3', 12)" class="i">int</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs2', 13)" onmouseover="showTip(event, 'fs2', 13)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> <span class="i">name</span>)       <span class="c">// Compiles</span>
    }</pre>
</td>
</tr>
</table>

<p>Currently this will cause the code to fail, however it is quite possible we can use that to implement a convention based system for passing extra things like headers, parameters, etc.</p>

<p>Anyway here is a <a href="https://github.com/simonhdickson/Fancy">link to the repo</a>, feel free to grab the code and have a play!</p>

<div class="tip" id="fs1">val pipeline : obj<br /><br />Full name: nancyplusfsharp.pipeline</div>
<div class="tip" id="fs2">val sprintf : format:Printf.StringFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.sprintf</div>
<div class="tip" id="fs3">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>

        </div>
    </div>
    <div class="col-sm-2 sidebar-2">
        	
	</div>
</article>
<div class="clearfix"></div>
            <!-- footer.html -->
		<footer>
			<hr/>
			<p>
				&copy; 2014 dbyll with Jekyll. Theme: <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek.
			</p>
		</footer>
		</div>
        <script type="text/javascript" src="http://localhost:8080/FsBlog/resources/jquery/jquery.min.js"></script>
	    <script type="text/javascript" src="http://localhost:8080/FsBlog/resources/bootstrap/js/bootstrap.min.js"></script>
	    <script type="text/javascript" src="http://localhost:8080/FsBlog/js/app.js"></script>
    </body>
</html>